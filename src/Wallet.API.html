<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveGeneric      #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DerivingStrategies #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts   #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances  #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE LambdaCase         #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell    #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies       #-}</span><span>
</span><a name="line-8"></a><span class="hs-comment">-- | Interface between wallet and Plutus client</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Wallet.API</span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>    </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span>    </span><a href="Wallet.API.html#WalletDiagnostics"><span class="hs-identifier hs-type">WalletDiagnostics</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-12"></a><span>    </span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-type">EventHandler</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-14"></a><span>    </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="Wallet.API.html#pubKey"><span class="hs-identifier hs-var">pubKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>    </span><a href="Wallet.API.html#keyPair"><span class="hs-identifier hs-var">keyPair</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-keyword">signature</span><span class="hs-special">,</span><span>
</span><a name="line-19"></a><span>    </span><a href="Wallet.API.html#createPayment"><span class="hs-identifier hs-var">createPayment</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>    </span><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier hs-var">signAndSubmit</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><a href="Wallet.API.html#payToScript"><span class="hs-identifier hs-var">payToScript</span></a><span class="hs-special">,</span><span>
</span><a name="line-22"></a><span>    </span><a href="Wallet.API.html#payToScript_"><span class="hs-identifier hs-var">payToScript_</span></a><span class="hs-special">,</span><span>
</span><a name="line-23"></a><span>    </span><a href="Wallet.API.html#payToPublicKey"><span class="hs-identifier hs-var">payToPublicKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>    </span><a href="Wallet.API.html#payToPublicKey_"><span class="hs-identifier hs-var">payToPublicKey_</span></a><span class="hs-special">,</span><span>
</span><a name="line-25"></a><span>    </span><a href="Wallet.API.html#collectFromScript"><span class="hs-identifier hs-var">collectFromScript</span></a><span class="hs-special">,</span><span>
</span><a name="line-26"></a><span>    </span><a href="Wallet.API.html#collectFromScriptTxn"><span class="hs-identifier hs-var">collectFromScriptTxn</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>    </span><a href="Wallet.API.html#ownPubKeyTxOut"><span class="hs-identifier hs-var">ownPubKeyTxOut</span></a><span class="hs-special">,</span><span>
</span><a name="line-28"></a><span>    </span><a href="Wallet.API.html#ownPubKey"><span class="hs-identifier hs-var">ownPubKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- * Triggers</span><span>
</span><a name="line-30"></a><span>    </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span class="hs-special">,</span><span>
</span><a name="line-31"></a><span>    </span><a href="Wallet.API.html#AnnotatedEventTrigger"><span class="hs-identifier hs-type">AnnotatedEventTrigger</span></a><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>    </span><a href="Wallet.API.html#EventTriggerF"><span class="hs-identifier hs-type">EventTriggerF</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-33"></a><span>    </span><a href="Wallet.API.html#andT"><span class="hs-identifier hs-var">andT</span></a><span class="hs-special">,</span><span>
</span><a name="line-34"></a><span>    </span><a href="Wallet.API.html#orT"><span class="hs-identifier hs-var">orT</span></a><span class="hs-special">,</span><span>
</span><a name="line-35"></a><span>    </span><a href="Wallet.API.html#notT"><span class="hs-identifier hs-var">notT</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>    </span><a href="Wallet.API.html#alwaysT"><span class="hs-identifier hs-var">alwaysT</span></a><span class="hs-special">,</span><span>
</span><a name="line-37"></a><span>    </span><a href="Wallet.API.html#neverT"><span class="hs-identifier hs-var">neverT</span></a><span class="hs-special">,</span><span>
</span><a name="line-38"></a><span>    </span><a href="Wallet.API.html#blockHeightT"><span class="hs-identifier hs-var">blockHeightT</span></a><span class="hs-special">,</span><span>
</span><a name="line-39"></a><span>    </span><a href="Wallet.API.html#fundsAtAddressT"><span class="hs-identifier hs-var">fundsAtAddressT</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><a href="Wallet.API.html#checkTrigger"><span class="hs-identifier hs-var">checkTrigger</span></a><span class="hs-special">,</span><span>
</span><a name="line-41"></a><span>    </span><a href="Wallet.API.html#addresses"><span class="hs-identifier hs-var">addresses</span></a><span class="hs-special">,</span><span>
</span><a name="line-42"></a><span>    </span><span class="hs-comment">-- AnnTriggerF,</span><span>
</span><a name="line-43"></a><span>    </span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span class="hs-special">,</span><span>
</span><a name="line-44"></a><span>    </span><a href="Wallet.API.html#annTruthValue"><span class="hs-identifier hs-var">annTruthValue</span></a><span class="hs-special">,</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-comment">-- * Error handling</span><span>
</span><a name="line-46"></a><span>    </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>    </span><a href="Wallet.API.html#throwInsufficientFundsError"><span class="hs-identifier hs-var">throwInsufficientFundsError</span></a><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>    </span><a href="Wallet.API.html#throwOtherError"><span class="hs-identifier hs-var">throwOtherError</span></a><span class="hs-special">,</span><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- * Logging</span><span>
</span><a name="line-50"></a><span>    </span><a href="Wallet.API.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-52"></a><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Lens</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad.Error.Class</span><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadError</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Aeson</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FromJSON</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Eq.Deriving</span><span>           </span><span class="hs-special">(</span><span class="hs-identifier hs-var">deriveEq1</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Functor.Compose</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Compose</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Functor.Foldable</span><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Corecursive</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Fix</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Recursive</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">unfix</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Maybe</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromMaybe</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Monoid</span><span>                </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Sum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Ord.Deriving</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-var">deriveOrd1</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-65"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Text</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Generics</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-67"></a><span class="hs-keyword">import</span><span>           </span><a href="Ledger.html"><span class="hs-identifier">Ledger</span></a><span>                     </span><span class="hs-special">(</span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#DataScript"><span class="hs-identifier hs-type">DataScript</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#RedeemerScript"><span class="hs-identifier hs-type">RedeemerScript</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-68"></a><span>                                             </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-type">Tx</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#TxId%27"><span class="hs-identifier hs-type">TxId'</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#TxIn%27"><span class="hs-identifier hs-type">TxIn'</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#TxOut"><span class="hs-identifier hs-type">TxOut</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#TxOut%27"><span class="hs-identifier hs-type">TxOut'</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#TxOutType"><span class="hs-identifier hs-type">TxOutType</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#ValidatorScript"><span class="hs-identifier hs-type">ValidatorScript</span></a><span class="hs-special">,</span><span>
</span><a name="line-69"></a><span>                                             </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#pubKeyTxOut"><span class="hs-identifier hs-var">pubKeyTxOut</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#scriptAddress"><span class="hs-identifier hs-var">scriptAddress</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#scriptTxIn"><span class="hs-identifier hs-var">scriptTxIn</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#txOutRefId"><span class="hs-identifier hs-var">txOutRefId</span></a><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Text.Show.Deriving</span><span>         </span><span class="hs-special">(</span><span class="hs-identifier hs-var">deriveShow1</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span>           </span><a href="Wallet.Emulator.AddressMap.html"><span class="hs-identifier">Wallet.Emulator.AddressMap</span></a><span> </span><span class="hs-special">(</span><a href="Wallet.Emulator.AddressMap.html#AddressMap"><span class="hs-identifier hs-type">AddressMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Prelude</span><span>                    </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Ordering</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-74"></a><span>
</span><a name="line-75"></a><span class="hs-keyword">newtype</span><span> </span><a name="PrivateKey"><a href="Wallet.API.html#PrivateKey"><span class="hs-identifier">PrivateKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PrivateKey"><a href="Wallet.API.html#PrivateKey"><span class="hs-identifier">PrivateKey</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getPrivateKey"><a href="Wallet.API.html#getPrivateKey"><span class="hs-identifier">getPrivateKey</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FromJSON</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">newtype</span><span> </span><a name="KeyPair"><a href="Wallet.API.html#KeyPair"><span class="hs-identifier">KeyPair</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="KeyPair"><a href="Wallet.API.html#KeyPair"><span class="hs-identifier">KeyPair</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getKeyPair"><a href="Wallet.API.html#getKeyPair"><span class="hs-identifier">getKeyPair</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#PrivateKey"><span class="hs-identifier hs-type">PrivateKey</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FromJSON</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-comment">-- | Get the public key of a [[KeyPair]]</span><span>
</span><a name="line-84"></a><span class="hs-identifier">pubKey</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span>
</span><a name="line-85"></a><a name="pubKey"><a href="Wallet.API.html#pubKey"><span class="hs-identifier">pubKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getKeyPair</span><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-comment">-- | Create a [[KeyPair]] given a &quot;private key&quot;</span><span>
</span><a name="line-88"></a><span class="hs-identifier">keyPair</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a><span>
</span><a name="line-89"></a><a name="keyPair"><a href="Wallet.API.html#keyPair"><span class="hs-identifier">keyPair</span></a></a><span> </span><a name="local-6989586621679478647"><a href="#local-6989586621679478647"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-var">KeyPair</span></a><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#PrivateKey"><span class="hs-identifier hs-var">PrivateKey</span></a><span> </span><a href="#local-6989586621679478647"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-var">PubKey</span></a><span> </span><a href="#local-6989586621679478647"><span class="hs-identifier hs-var">i</span></a><span class="hs-special">)</span><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span class="hs-comment">-- | Create a [[Signature]] signed by the private key of a</span><span>
</span><a name="line-92"></a><span class="hs-comment">--   [[KeyPair]]</span><span>
</span><a name="line-93"></a><span class="hs-keyword">signature</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span>
</span><a name="line-94"></a><span class="hs-keyword">signature</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-var">Signature</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getPrivateKey</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getKeyPair</span><span>
</span><a name="line-95"></a><span>
</span><a name="line-96"></a><span class="hs-keyword">data</span><span> </span><a name="Range"><a href="Wallet.API.html#Range"><span class="hs-identifier">Range</span></a></a><span> </span><a name="local-6989586621679478645"><a href="#local-6989586621679478645"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-97"></a><span>    </span><a name="Interval"><a href="Wallet.API.html#Interval"><span class="hs-identifier">Interval</span></a></a><span> </span><a href="#local-6989586621679478645"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679478645"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ inclusive-exclusive</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="GEQ"><a href="Wallet.API.html#GEQ"><span class="hs-identifier">GEQ</span></a></a><span> </span><a href="#local-6989586621679478645"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-99"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="LT"><a href="Wallet.API.html#LT"><span class="hs-identifier">LT</span></a></a><span> </span><a href="#local-6989586621679478645"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-100"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-identifier">inRange</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Ord</span><span> </span><a href="#local-6989586621679478646"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679478646"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span> </span><a href="#local-6989586621679478646"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-103"></a><a name="inRange"><a href="Wallet.API.html#inRange"><span class="hs-identifier">inRange</span></a></a><span> </span><a name="local-6989586621679478648"><a href="#local-6989586621679478648"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-104"></a><span>    </span><a href="Wallet.API.html#Interval"><span class="hs-identifier hs-var">Interval</span></a><span> </span><a name="local-6989586621679478649"><a href="#local-6989586621679478649"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679478650"><a href="#local-6989586621679478650"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679478648"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679478649"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="#local-6989586621679478648"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span> </span><a href="#local-6989586621679478650"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-105"></a><span>    </span><a href="Wallet.API.html#GEQ"><span class="hs-identifier hs-var">GEQ</span></a><span> </span><a name="local-6989586621679478651"><a href="#local-6989586621679478651"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679478648"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;=</span><span> </span><a href="#local-6989586621679478651"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-106"></a><span>    </span><a href="Wallet.API.html#LT"><span class="hs-identifier hs-var">LT</span></a><span>  </span><a name="local-6989586621679478652"><a href="#local-6989586621679478652"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679478648"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&lt;</span><span>  </span><a href="#local-6989586621679478652"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-keyword">data</span><span> </span><a name="EventTriggerF"><a href="Wallet.API.html#EventTriggerF"><span class="hs-identifier">EventTriggerF</span></a></a><span> </span><a name="local-6989586621679478644"><a href="#local-6989586621679478644"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-109"></a><span>    </span><a name="And"><a href="Wallet.API.html#And"><span class="hs-identifier">And</span></a></a><span> </span><a href="#local-6989586621679478644"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679478644"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-110"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Or"><a href="Wallet.API.html#Or"><span class="hs-identifier">Or</span></a></a><span> </span><a href="#local-6989586621679478644"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679478644"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-111"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Not"><a href="Wallet.API.html#Not"><span class="hs-identifier">Not</span></a></a><span> </span><a href="#local-6989586621679478644"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-112"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="PAlways"><a href="Wallet.API.html#PAlways"><span class="hs-identifier">PAlways</span></a></a><span>
</span><a name="line-113"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="PNever"><a href="Wallet.API.html#PNever"><span class="hs-identifier">PNever</span></a></a><span>
</span><a name="line-114"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="BlockHeightRange"><a href="Wallet.API.html#BlockHeightRange"><span class="hs-identifier">BlockHeightRange</span></a></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span class="hs-special">)</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="FundsAtAddress"><a href="Wallet.API.html#FundsAtAddress"><span class="hs-identifier">FundsAtAddress</span></a></a><span> </span><span class="hs-glyph">!</span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Foldable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Traversable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-special">$(</span><span class="hs-identifier hs-var">deriveEq1</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">EventTriggerF</span><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span class="hs-special">$(</span><span class="hs-identifier hs-var">deriveOrd1</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">EventTriggerF</span><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span class="hs-special">$(</span><span class="hs-identifier hs-var">deriveShow1</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">EventTriggerF</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>
</span><a name="line-122"></a><span class="hs-comment">-- | An [[EventTrigger]] where each level is annotated with a value of `a`</span><span>
</span><a name="line-123"></a><span class="hs-keyword">type</span><span> </span><a name="AnnotatedEventTrigger"><a href="Wallet.API.html#AnnotatedEventTrigger"><span class="hs-identifier">AnnotatedEventTrigger</span></a></a><span> </span><a name="local-6989586621679484948"><a href="#local-6989586621679484948"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Fix</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Compose</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679484948"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="Wallet.API.html#EventTriggerF"><span class="hs-identifier hs-type">EventTriggerF</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-keyword">type</span><span> </span><a name="EventTrigger"><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier">EventTrigger</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">Fix</span><span> </span><a href="Wallet.API.html#EventTriggerF"><span class="hs-identifier hs-type">EventTriggerF</span></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-identifier">getAnnot</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#AnnotatedEventTrigger"><span class="hs-identifier hs-type">AnnotatedEventTrigger</span></a><span> </span><a href="#local-6989586621679484968"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484968"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-128"></a><a name="getAnnot"><a href="Wallet.API.html#getAnnot"><span class="hs-identifier">getAnnot</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">getCompose</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">unfix</span><span>
</span><a name="line-129"></a><span>
</span><a name="line-130"></a><span class="hs-comment">-- | `andT l r` is true when `l` and `r` are true.</span><span>
</span><a name="line-131"></a><span class="hs-identifier">andT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-132"></a><a name="andT"><a href="Wallet.API.html#andT"><span class="hs-identifier">andT</span></a></a><span> </span><a name="local-6989586621679484969"><a href="#local-6989586621679484969"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#And"><span class="hs-identifier hs-var">And</span></a><span> </span><a href="#local-6989586621679484969"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span class="hs-comment">-- | `orT l r` is true when `l` or `r` are true.</span><span>
</span><a name="line-135"></a><span class="hs-identifier">orT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-136"></a><a name="orT"><a href="Wallet.API.html#orT"><span class="hs-identifier">orT</span></a></a><span> </span><a name="local-6989586621679484970"><a href="#local-6989586621679484970"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a href="#local-6989586621679484970"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-137"></a><span>
</span><a name="line-138"></a><span class="hs-comment">-- | `alwaysT` is always true</span><span>
</span><a name="line-139"></a><span class="hs-identifier">alwaysT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-140"></a><a name="alwaysT"><a href="Wallet.API.html#alwaysT"><span class="hs-identifier">alwaysT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><a href="Wallet.API.html#PAlways"><span class="hs-identifier hs-var">PAlways</span></a><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- | `neverT` is never true</span><span>
</span><a name="line-143"></a><span class="hs-identifier">neverT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-144"></a><a name="neverT"><a href="Wallet.API.html#neverT"><span class="hs-identifier">neverT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><a href="Wallet.API.html#PNever"><span class="hs-identifier hs-var">PNever</span></a><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span class="hs-comment">-- | `blockHeightT r` is true when the block height is in the range `r`</span><span>
</span><a name="line-147"></a><span class="hs-identifier">blockHeightT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-148"></a><a name="blockHeightT"><a href="Wallet.API.html#blockHeightT"><span class="hs-identifier">blockHeightT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#BlockHeightRange"><span class="hs-identifier hs-var">BlockHeightRange</span></a><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span class="hs-comment">-- | `fundsAtAddressT a r` is true when the funds at `a` are in the range `r`</span><span>
</span><a name="line-151"></a><span class="hs-identifier">fundsAtAddressT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#Range"><span class="hs-identifier hs-type">Range</span></a><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-152"></a><a name="fundsAtAddressT"><a href="Wallet.API.html#fundsAtAddressT"><span class="hs-identifier">fundsAtAddressT</span></a></a><span> </span><a name="local-6989586621679484971"><a href="#local-6989586621679484971"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#FundsAtAddress"><span class="hs-identifier hs-var">FundsAtAddress</span></a><span> </span><a href="#local-6989586621679484971"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-153"></a><span>
</span><a name="line-154"></a><span class="hs-comment">-- | `notT t` is true when `t` is false</span><span>
</span><a name="line-155"></a><span class="hs-identifier">notT</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span>
</span><a name="line-156"></a><a name="notT"><a href="Wallet.API.html#notT"><span class="hs-identifier">notT</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#Not"><span class="hs-identifier hs-var">Not</span></a><span>
</span><a name="line-157"></a><span>
</span><a name="line-158"></a><span class="hs-comment">-- | Check if the given block height and UTXOs match the</span><span>
</span><a name="line-159"></a><span class="hs-comment">--   conditions of an [[EventTrigger]]</span><span>
</span><a name="line-160"></a><span class="hs-identifier">checkTrigger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-161"></a><a name="checkTrigger"><a href="Wallet.API.html#checkTrigger"><span class="hs-identifier">checkTrigger</span></a></a><span> </span><a name="local-6989586621679484972"><a href="#local-6989586621679484972"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679484973"><a href="#local-6989586621679484973"><span class="hs-identifier">mp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#annTruthValue"><span class="hs-identifier hs-var">annTruthValue</span></a><span> </span><a href="#local-6989586621679484972"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679484973"><span class="hs-identifier hs-var">mp</span></a><span>
</span><a name="line-162"></a><span>
</span><a name="line-163"></a><span class="hs-comment">-- | Annotate each node in an `EventTriggerF` with its truth value given a block height</span><span>
</span><a name="line-164"></a><span class="hs-comment">--   and a set of unspent outputs</span><span>
</span><a name="line-165"></a><span class="hs-identifier">annTruthValue</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Map.Map</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#AnnotatedEventTrigger"><span class="hs-identifier hs-type">AnnotatedEventTrigger</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-166"></a><a name="annTruthValue"><a href="Wallet.API.html#annTruthValue"><span class="hs-identifier">annTruthValue</span></a></a><span> </span><a name="local-6989586621679484974"><a href="#local-6989586621679484974"><span class="hs-identifier">h</span></a></a><span> </span><a name="local-6989586621679484975"><a href="#local-6989586621679484975"><span class="hs-identifier">mp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cata</span><span> </span><a href="#local-6989586621679484977"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-167"></a><span>    </span><a name="local-6989586621679484976"><a href="#local-6989586621679484976"><span class="hs-identifier">embedC</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">embed</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Compose</span><span>
</span><a name="line-168"></a><span>    </span><a name="local-6989586621679484977"><a href="#local-6989586621679484977"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-169"></a><span>        </span><a href="Wallet.API.html#And"><span class="hs-identifier hs-var">And</span></a><span> </span><a name="local-6989586621679484978"><a href="#local-6989586621679484978"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679484979"><a href="#local-6989586621679484979"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><a href="#local-6989586621679484978"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><a href="#local-6989586621679484979"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#And"><span class="hs-identifier hs-var">And</span></a><span> </span><a href="#local-6989586621679484978"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679484979"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>        </span><a href="Wallet.API.html#Or"><span class="hs-identifier hs-var">Or</span></a><span>  </span><a name="local-6989586621679484980"><a href="#local-6989586621679484980"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679484981"><a href="#local-6989586621679484981"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><a href="#local-6989586621679484980"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">||</span><span> </span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><a href="#local-6989586621679484981"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a href="#local-6989586621679484980"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679484981"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>        </span><a href="Wallet.API.html#Not"><span class="hs-identifier hs-var">Not</span></a><span> </span><a name="local-6989586621679484982"><a href="#local-6989586621679484982"><span class="hs-identifier">r</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">not</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Wallet.API.html#getAnnot"><span class="hs-identifier hs-var">getAnnot</span></a><span> </span><a href="#local-6989586621679484982"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#Not"><span class="hs-identifier hs-var">Not</span></a><span> </span><a href="#local-6989586621679484982"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>        </span><a href="Wallet.API.html#PAlways"><span class="hs-identifier hs-var">PAlways</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">True</span><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#PAlways"><span class="hs-identifier hs-var">PAlways</span></a><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span>        </span><a href="Wallet.API.html#PNever"><span class="hs-identifier hs-var">PNever</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">False</span><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#PNever"><span class="hs-identifier hs-var">PNever</span></a><span class="hs-special">)</span><span>
</span><a name="line-174"></a><span>        </span><a href="Wallet.API.html#BlockHeightRange"><span class="hs-identifier hs-var">BlockHeightRange</span></a><span> </span><a name="local-6989586621679484983"><a href="#local-6989586621679484983"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679484974"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-special">`</span><a href="Wallet.API.html#inRange"><span class="hs-identifier hs-var">inRange</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679484983"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#BlockHeightRange"><span class="hs-identifier hs-var">BlockHeightRange</span></a><span> </span><a href="#local-6989586621679484983"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-175"></a><span>        </span><a href="Wallet.API.html#FundsAtAddress"><span class="hs-identifier hs-var">FundsAtAddress</span></a><span> </span><a name="local-6989586621679484984"><a href="#local-6989586621679484984"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679484985"><a href="#local-6989586621679484985"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-176"></a><span>            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679484986"><a href="#local-6989586621679484986"><span class="hs-identifier">funds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679484984"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679484975"><span class="hs-identifier hs-var">mp</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-177"></a><span>            </span><a href="#local-6989586621679484976"><span class="hs-identifier hs-var">embedC</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679484986"><span class="hs-identifier hs-var">funds</span></a><span> </span><span class="hs-special">`</span><a href="Wallet.API.html#inRange"><span class="hs-identifier hs-var">inRange</span></a><span class="hs-special">`</span><span> </span><a href="#local-6989586621679484985"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#FundsAtAddress"><span class="hs-identifier hs-var">FundsAtAddress</span></a><span> </span><a href="#local-6989586621679484984"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679484985"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- | The addresses that an [[EventTrigger]] refers to</span><span>
</span><a name="line-180"></a><span class="hs-identifier">addresses</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span class="hs-special">]</span><span>
</span><a name="line-181"></a><a name="addresses"><a href="Wallet.API.html#addresses"><span class="hs-identifier">addresses</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">cata</span><span> </span><a href="#local-6989586621679484987"><span class="hs-identifier hs-var">adr</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-182"></a><span>    </span><a name="local-6989586621679484987"><a href="#local-6989586621679484987"><span class="hs-identifier">adr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><a name="line-183"></a><span>        </span><a href="Wallet.API.html#And"><span class="hs-identifier hs-var">And</span></a><span> </span><a name="local-6989586621679484988"><a href="#local-6989586621679484988"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679484989"><a href="#local-6989586621679484989"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484988"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679484989"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-184"></a><span>        </span><a href="Wallet.API.html#Or"><span class="hs-identifier hs-var">Or</span></a><span> </span><a name="local-6989586621679484990"><a href="#local-6989586621679484990"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-6989586621679484991"><a href="#local-6989586621679484991"><span class="hs-identifier">r</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484990"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679484991"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-185"></a><span>        </span><a href="Wallet.API.html#Not"><span class="hs-identifier hs-var">Not</span></a><span> </span><a name="local-6989586621679484992"><a href="#local-6989586621679484992"><span class="hs-identifier">t</span></a></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484992"><span class="hs-identifier hs-var">t</span></a><span>
</span><a name="line-186"></a><span>        </span><a href="Wallet.API.html#PAlways"><span class="hs-identifier hs-var">PAlways</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-187"></a><span>        </span><a href="Wallet.API.html#PNever"><span class="hs-identifier hs-var">PNever</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-188"></a><span>        </span><a href="Wallet.API.html#BlockHeightRange"><span class="hs-identifier hs-var">BlockHeightRange</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-189"></a><span>        </span><a href="Wallet.API.html#FundsAtAddress"><span class="hs-identifier hs-var">FundsAtAddress</span></a><span> </span><a name="local-6989586621679484993"><a href="#local-6989586621679484993"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679484993"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">]</span><span>
</span><a name="line-190"></a><span>
</span><a name="line-191"></a><span class="hs-comment">-- | An action than can be run in response to a blockchain event. It receives</span><span>
</span><a name="line-192"></a><span class="hs-comment">--   its [[EventTrigger]] annotated with truth values.</span><span>
</span><a name="line-193"></a><span class="hs-keyword">newtype</span><span> </span><a name="EventHandler"><a href="Wallet.API.html#EventHandler"><span class="hs-identifier">EventHandler</span></a></a><span> </span><a name="local-6989586621679484947"><a href="#local-6989586621679484947"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="EventHandler"><a href="Wallet.API.html#EventHandler"><span class="hs-identifier">EventHandler</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="runEventHandler"><a href="Wallet.API.html#runEventHandler"><span class="hs-identifier">runEventHandler</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#AnnotatedEventTrigger"><span class="hs-identifier hs-type">AnnotatedEventTrigger</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484947"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484950"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-type">EventHandler</span></a><span> </span><a href="#local-6989586621679484950"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-196"></a><span>    </span><a name="local-6989586621679484951"><a href="#local-6989586621679484951"><span class="hs-identifier">l</span></a></a><span> </span><a name="local-3458764513820541482"><span class="hs-operator">&lt;&gt;</span></a><span> </span><a name="local-6989586621679484952"><a href="#local-6989586621679484952"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-var">EventHandler</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679484953"><a href="#local-6989586621679484953"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-197"></a><span>        </span><span class="hs-identifier">runEventHandler</span><span> </span><a href="#local-6989586621679484951"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679484953"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier">runEventHandler</span><span> </span><a href="#local-6989586621679484952"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679484953"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484949"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span> </span><span class="hs-special">(</span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-type">EventHandler</span></a><span> </span><a href="#local-6989586621679484949"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-200"></a><span>    </span><a name="local-3458764513820541484"><span class="hs-identifier">mappend</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&lt;&gt;</span><span class="hs-special">)</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-3458764513820541483"><span class="hs-identifier">mempty</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-var">EventHandler</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-keyword">data</span><span> </span><a name="WalletAPIError"><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier">WalletAPIError</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-204"></a><span>    </span><a name="InsufficientFunds"><a href="Wallet.API.html#InsufficientFunds"><span class="hs-identifier">InsufficientFunds</span></a></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="OtherError"><a href="Wallet.API.html#OtherError"><span class="hs-identifier">OtherError</span></a></a><span> </span><span class="hs-identifier hs-type">Text</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">FromJSON</span><span> </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span>
</span><a name="line-209"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span>
</span><a name="line-210"></a><span>
</span><a name="line-211"></a><span class="hs-keyword">newtype</span><span> </span><a name="WalletLog"><a href="Wallet.API.html#WalletLog"><span class="hs-identifier">WalletLog</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="WalletLog"><a href="Wallet.API.html#WalletLog"><span class="hs-identifier">WalletLog</span></a></a><span> </span><span class="hs-special">{</span><span> </span><a name="getWalletLog"><a href="Wallet.API.html#getWalletLog"><span class="hs-identifier">getWalletLog</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">Text</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Semigroup</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Monoid</span><span class="hs-special">)</span><span>
</span><a name="line-213"></a><span>
</span><a name="line-214"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">FromJSON</span><span> </span><a href="Wallet.API.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a><span>
</span><a name="line-215"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="Wallet.API.html#WalletLog"><span class="hs-identifier hs-type">WalletLog</span></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span class="hs-comment">-- | The ability to log messages and throw errors</span><span>
</span><a name="line-218"></a><span class="hs-keyword">class</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span> </span><a href="#local-6989586621679484946"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a name="WalletDiagnostics"><a href="Wallet.API.html#WalletDiagnostics"><span class="hs-identifier">WalletDiagnostics</span></a></a><span> </span><a name="local-6989586621679484946"><a href="#local-6989586621679484946"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-219"></a><span>    </span><span class="hs-comment">-- | Write some information to the log</span><span>
</span><a name="line-220"></a><span>    </span><a name="logMsg"><a href="Wallet.API.html#logMsg"><span class="hs-identifier">logMsg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484946"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>
</span><a name="line-222"></a><span class="hs-comment">-- | Used by Plutus client to interact with wallet</span><span>
</span><a name="line-223"></a><span class="hs-keyword">class</span><span> </span><a name="WalletAPI"><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier">WalletAPI</span></a></a><span> </span><a name="local-6989586621679484945"><a href="#local-6989586621679484945"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-224"></a><span>    </span><a name="submitTxn"><a href="Wallet.API.html#submitTxn"><span class="hs-identifier">submitTxn</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-type">Tx</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>    </span><a name="myKeyPair"><a href="Wallet.API.html#myKeyPair"><span class="hs-identifier">myKeyPair</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Wallet.API.html#KeyPair"><span class="hs-identifier hs-type">KeyPair</span></a><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span>    </span><span class="hs-comment">{- |
    Create a payment that spends the specified value and returns any
    leftover funds as change. Fails if we don't have enough funds.
    -}</span><span>
</span><a name="line-231"></a><span>    </span><a name="createPaymentWithChange"><a href="Wallet.API.html#createPaymentWithChange"><span class="hs-identifier">createPaymentWithChange</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set.Set</span><span> </span><a href="Ledger.Types.html#TxIn%27"><span class="hs-identifier hs-type">TxIn'</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Ledger.Types.html#TxOut%27"><span class="hs-identifier hs-type">TxOut'</span></a><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span>
</span><a name="line-233"></a><span>    </span><span class="hs-comment">{- |
    Register a [[EventHandler]] in `m ()` to be run when condition is true.

    * The action will be run once for each block where the condition holds.
      For example, `register (blockHeightT (Interval 3 6)) a` causes `a` to be run at blocks 3, 4, and 5.

    * Each time the wallet is notified of a new block, all triggers are checked
      and the matching ones are run in an unspecified order.

    * The wallet will only watch &quot;known&quot; addresses. There are two ways an
      address can become a known address.
      1. When a trigger is registered for it
      2. When a transaction submitted by this wallet produces an output for it
      When an address is added to the set of known addresses, it starts out with
      an initial value of 0. If there already exist unspent transaction outputs
      at that address on the chain, then those will be ignored.

    * `register c a &gt;&gt; register c b = register c (a &gt;&gt; b)`
    -}</span><span>
</span><a name="line-252"></a><span>    </span><a name="register"><a href="Wallet.API.html#register"><span class="hs-identifier">register</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Wallet.API.html#EventTrigger"><span class="hs-identifier hs-type">EventTrigger</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Wallet.API.html#EventHandler"><span class="hs-identifier hs-type">EventHandler</span></a><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span>    </span><span class="hs-comment">{-
    The [[AddressMap]] of all addresses currently watched by the wallet.
    -}</span><span>
</span><a name="line-257"></a><span>    </span><a name="watchedAddresses"><a href="Wallet.API.html#watchedAddresses"><span class="hs-identifier">watchedAddresses</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Wallet.Emulator.AddressMap.html#AddressMap"><span class="hs-identifier hs-type">AddressMap</span></a><span>
</span><a name="line-258"></a><span>
</span><a name="line-259"></a><span>    </span><span class="hs-comment">{-
    Start watching an address.
    -}</span><span>
</span><a name="line-262"></a><span>    </span><a name="startWatching"><a href="Wallet.API.html#startWatching"><span class="hs-identifier">startWatching</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>    </span><span class="hs-comment">{-
    The current block height.
    -}</span><span>
</span><a name="line-267"></a><span>    </span><a name="blockHeight"><a href="Wallet.API.html#blockHeight"><span class="hs-identifier">blockHeight</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679484945"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-identifier">throwInsufficientFundsError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span> </span><a href="#local-6989586621679484966"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484966"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679484967"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-270"></a><a name="throwInsufficientFundsError"><a href="Wallet.API.html#throwInsufficientFundsError"><span class="hs-identifier">throwInsufficientFundsError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#InsufficientFunds"><span class="hs-identifier hs-var">InsufficientFunds</span></a><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-identifier">throwOtherError</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadError</span><span> </span><a href="Wallet.API.html#WalletAPIError"><span class="hs-identifier hs-type">WalletAPIError</span></a><span> </span><a href="#local-6989586621679484964"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484964"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679484965"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-273"></a><a name="throwOtherError"><a href="Wallet.API.html#throwOtherError"><span class="hs-identifier">throwOtherError</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">throwError</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#OtherError"><span class="hs-identifier hs-var">OtherError</span></a><span>
</span><a name="line-274"></a><span>
</span><a name="line-275"></a><span class="hs-identifier">createPayment</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679484963"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484963"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484963"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Set.Set</span><span> </span><a href="Ledger.Types.html#TxIn%27"><span class="hs-identifier hs-type">TxIn'</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><a name="createPayment"><a href="Wallet.API.html#createPayment"><span class="hs-identifier">createPayment</span></a></a><span> </span><a name="local-6989586621679484994"><a href="#local-6989586621679484994"><span class="hs-identifier">vl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Wallet.API.html#createPaymentWithChange"><span class="hs-identifier hs-var">createPaymentWithChange</span></a><span> </span><a href="#local-6989586621679484994"><span class="hs-identifier hs-var">vl</span></a><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | Transfer some funds to an address locked by a script, returning the</span><span>
</span><a name="line-279"></a><span class="hs-comment">--   transaction that was submitted.</span><span>
</span><a name="line-280"></a><span class="hs-identifier">payToScript</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484962"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484962"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#DataScript"><span class="hs-identifier hs-type">DataScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484962"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-type">Tx</span></a><span>
</span><a name="line-281"></a><a name="payToScript"><a href="Wallet.API.html#payToScript"><span class="hs-identifier">payToScript</span></a></a><span> </span><a name="local-6989586621679484995"><a href="#local-6989586621679484995"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621679484996"><a href="#local-6989586621679484996"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679484997"><a href="#local-6989586621679484997"><span class="hs-identifier">ds</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-282"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679484998"><a href="#local-6989586621679484998"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679484999"><a href="#local-6989586621679484999"><span class="hs-identifier">own</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#createPaymentWithChange"><span class="hs-identifier hs-var">createPaymentWithChange</span></a><span> </span><a href="#local-6989586621679484996"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-283"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679485000"><a href="#local-6989586621679485000"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#TxOut"><span class="hs-identifier hs-var">TxOut</span></a><span> </span><a href="#local-6989586621679484995"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621679484996"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#PayToScript"><span class="hs-identifier hs-var">PayToScript</span></a><span> </span><a href="#local-6989586621679484997"><span class="hs-identifier hs-var">ds</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>    </span><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier hs-var">signAndSubmit</span></a><span> </span><a href="#local-6989586621679484998"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679485000"><span class="hs-identifier hs-var">other</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span> </span><a href="#local-6989586621679484999"><span class="hs-identifier hs-var">own</span></a><span class="hs-special">)</span><span>
</span><a name="line-285"></a><span>
</span><a name="line-286"></a><span class="hs-comment">-- | Transfer some funds to an address locked by a script.</span><span>
</span><a name="line-287"></a><span class="hs-identifier">payToScript_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484961"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484961"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Address%27"><span class="hs-identifier hs-type">Address'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#DataScript"><span class="hs-identifier hs-type">DataScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484961"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-288"></a><a name="payToScript_"><a href="Wallet.API.html#payToScript_"><span class="hs-identifier">payToScript_</span></a></a><span> </span><a name="local-6989586621679485001"><a href="#local-6989586621679485001"><span class="hs-identifier">addr</span></a></a><span> </span><a name="local-6989586621679485002"><a href="#local-6989586621679485002"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#payToScript"><span class="hs-identifier hs-var">payToScript</span></a><span> </span><a href="#local-6989586621679485001"><span class="hs-identifier hs-var">addr</span></a><span> </span><a href="#local-6989586621679485002"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-289"></a><span>
</span><a name="line-290"></a><span class="hs-comment">-- | Collect all unspent outputs from a pay to script address and transfer them</span><span>
</span><a name="line-291"></a><span class="hs-comment">--   to a public key owned by us.</span><span>
</span><a name="line-292"></a><span class="hs-identifier">collectFromScript</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484960"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484960"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#ValidatorScript"><span class="hs-identifier hs-type">ValidatorScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#RedeemerScript"><span class="hs-identifier hs-type">RedeemerScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484960"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><a name="collectFromScript"><a href="Wallet.API.html#collectFromScript"><span class="hs-identifier">collectFromScript</span></a></a><span> </span><a name="local-6989586621679485003"><a href="#local-6989586621679485003"><span class="hs-identifier">scr</span></a></a><span> </span><a name="local-6989586621679485004"><a href="#local-6989586621679485004"><span class="hs-identifier">red</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-294"></a><span>    </span><a name="local-6989586621679485005"><a href="#local-6989586621679485005"><span class="hs-identifier">am</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#watchedAddresses"><span class="hs-identifier hs-var">watchedAddresses</span></a><span>
</span><a name="line-295"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679485006"><a href="#local-6989586621679485006"><span class="hs-identifier">addr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#scriptAddress"><span class="hs-identifier hs-var">scriptAddress</span></a><span> </span><a href="#local-6989586621679485003"><span class="hs-identifier hs-var">scr</span></a><span>
</span><a name="line-296"></a><span>        </span><a name="local-6989586621679485007"><a href="#local-6989586621679485007"><span class="hs-identifier">outputs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679485005"><span class="hs-identifier hs-var">am</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><span class="hs-identifier hs-var">at</span><span> </span><a href="#local-6989586621679485006"><span class="hs-identifier hs-var">addr</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">to</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.toList</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span class="hs-special">)</span><span>
</span><a name="line-297"></a><span>        </span><a name="local-6989586621679485008"><a href="#local-6989586621679485008"><span class="hs-identifier">con</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679485011"><a href="#local-6989586621679485011"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#scriptTxIn"><span class="hs-identifier hs-var">scriptTxIn</span></a><span> </span><a href="#local-6989586621679485011"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679485003"><span class="hs-identifier hs-var">scr</span></a><span> </span><a href="#local-6989586621679485004"><span class="hs-identifier hs-var">red</span></a><span>
</span><a name="line-298"></a><span>        </span><a name="local-6989586621679485009"><a href="#local-6989586621679485009"><span class="hs-identifier">ins</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679485008"><span class="hs-identifier hs-var">con</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679485007"><span class="hs-identifier hs-var">outputs</span></a><span>
</span><a name="line-299"></a><span>        </span><a name="local-6989586621679485010"><a href="#local-6989586621679485010"><span class="hs-identifier">value</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getSum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679485007"><span class="hs-identifier hs-var">outputs</span></a><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span>    </span><a name="local-6989586621679485012"><a href="#local-6989586621679485012"><span class="hs-identifier">oo</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#ownPubKeyTxOut"><span class="hs-identifier hs-var">ownPubKeyTxOut</span></a><span> </span><a href="#local-6989586621679485010"><span class="hs-identifier hs-var">value</span></a><span>
</span><a name="line-302"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier hs-var">signAndSubmit</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><a href="#local-6989586621679485009"><span class="hs-identifier hs-var">ins</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679485012"><span class="hs-identifier hs-var">oo</span></a><span class="hs-special">]</span><span>
</span><a name="line-303"></a><span>
</span><a name="line-304"></a><span class="hs-comment">-- | Given the pay to script address of the 'ValidatorScript', collect from it</span><span>
</span><a name="line-305"></a><span class="hs-comment">--   all the inputs that were produced by a specific transaction, using the</span><span>
</span><a name="line-306"></a><span class="hs-comment">--   'RedeemerScript'.</span><span>
</span><a name="line-307"></a><span class="hs-identifier">collectFromScriptTxn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484959"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484959"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#ValidatorScript"><span class="hs-identifier hs-type">ValidatorScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#RedeemerScript"><span class="hs-identifier hs-type">RedeemerScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#TxId%27"><span class="hs-identifier hs-type">TxId'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484959"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-308"></a><a name="collectFromScriptTxn"><a href="Wallet.API.html#collectFromScriptTxn"><span class="hs-identifier">collectFromScriptTxn</span></a></a><span> </span><a name="local-6989586621679485013"><a href="#local-6989586621679485013"><span class="hs-identifier">vls</span></a></a><span> </span><a name="local-6989586621679485014"><a href="#local-6989586621679485014"><span class="hs-identifier">red</span></a></a><span> </span><a name="local-6989586621679485015"><a href="#local-6989586621679485015"><span class="hs-identifier">txid</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-309"></a><span>    </span><a name="local-6989586621679485016"><a href="#local-6989586621679485016"><span class="hs-identifier">am</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#watchedAddresses"><span class="hs-identifier hs-var">watchedAddresses</span></a><span>
</span><a name="line-310"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679485017"><a href="#local-6989586621679485017"><span class="hs-identifier">adr</span></a></a><span>     </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#scriptAddress"><span class="hs-identifier hs-var">Ledger.scriptAddress</span></a><span> </span><a href="#local-6989586621679485013"><span class="hs-identifier hs-var">vls</span></a><span>
</span><a name="line-311"></a><span>        </span><a name="local-6989586621679485018"><a href="#local-6989586621679485018"><span class="hs-identifier">utxo</span></a></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromMaybe</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679485016"><span class="hs-identifier hs-var">am</span></a><span> </span><span class="hs-operator hs-var">^.</span><span> </span><span class="hs-identifier hs-var">at</span><span> </span><a href="#local-6989586621679485017"><span class="hs-identifier hs-var">adr</span></a><span>
</span><a name="line-312"></a><span>        </span><a name="local-6989586621679485019"><a href="#local-6989586621679485019"><span class="hs-identifier">ourUtxo</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.toList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Map.filterWithKey</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679485023"><a href="#local-6989586621679485023"><span class="hs-identifier">k</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679485015"><span class="hs-identifier hs-var">txid</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier">Ledger.txOutRefId</span><span> </span><a href="#local-6989586621679485023"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679485018"><span class="hs-identifier hs-var">utxo</span></a><span>
</span><a name="line-313"></a><span>        </span><a name="local-6989586621679485020"><a href="#local-6989586621679485020"><span class="hs-identifier">i</span></a></a><span> </span><a name="local-6989586621679485024"><a href="#local-6989586621679485024"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#scriptTxIn"><span class="hs-identifier hs-var">scriptTxIn</span></a><span> </span><a href="#local-6989586621679485024"><span class="hs-identifier hs-var">ref</span></a><span> </span><a href="#local-6989586621679485013"><span class="hs-identifier hs-var">vls</span></a><span> </span><a href="#local-6989586621679485014"><span class="hs-identifier hs-var">red</span></a><span>
</span><a name="line-314"></a><span>        </span><a name="local-6989586621679485021"><a href="#local-6989586621679485021"><span class="hs-identifier">inputs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679485020"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">fst</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="#local-6989586621679485019"><span class="hs-identifier hs-var">ourUtxo</span></a><span>
</span><a name="line-315"></a><span>        </span><a name="local-6989586621679485022"><a href="#local-6989586621679485022"><span class="hs-identifier">value</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">getSum</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">foldMap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Sum</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">snd</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679485019"><span class="hs-identifier hs-var">ourUtxo</span></a><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span>    </span><a name="local-6989586621679485025"><a href="#local-6989586621679485025"><span class="hs-identifier">out</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#ownPubKeyTxOut"><span class="hs-identifier hs-var">ownPubKeyTxOut</span></a><span> </span><a href="#local-6989586621679485022"><span class="hs-identifier hs-var">value</span></a><span>
</span><a name="line-318"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier hs-var">signAndSubmit</span></a><span> </span><a href="#local-6989586621679485021"><span class="hs-identifier hs-var">inputs</span></a><span> </span><span class="hs-special">[</span><a href="#local-6989586621679485025"><span class="hs-identifier hs-var">out</span></a><span class="hs-special">]</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | Get the public key for this wallet</span><span>
</span><a name="line-321"></a><span class="hs-identifier">ownPubKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679484958"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484958"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679484958"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span>
</span><a name="line-322"></a><a name="ownPubKey"><a href="Wallet.API.html#ownPubKey"><span class="hs-identifier">ownPubKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Wallet.API.html#pubKey"><span class="hs-identifier hs-var">pubKey</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Wallet.API.html#myKeyPair"><span class="hs-identifier hs-var">myKeyPair</span></a><span>
</span><a name="line-323"></a><span>
</span><a name="line-324"></a><span class="hs-comment">-- | Transfer some funds to an address locked by a public key, returning the</span><span>
</span><a name="line-325"></a><span class="hs-comment">--   transaction that was submitted.</span><span>
</span><a name="line-326"></a><span class="hs-identifier">payToPublicKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484957"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484957"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484957"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-type">Tx</span></a><span>
</span><a name="line-327"></a><a name="payToPublicKey"><a href="Wallet.API.html#payToPublicKey"><span class="hs-identifier">payToPublicKey</span></a></a><span> </span><a name="local-6989586621679485026"><a href="#local-6989586621679485026"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679485027"><a href="#local-6989586621679485027"><span class="hs-identifier">pk</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-328"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679485028"><a href="#local-6989586621679485028"><span class="hs-identifier">i</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679485029"><a href="#local-6989586621679485029"><span class="hs-identifier">own</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="Wallet.API.html#createPaymentWithChange"><span class="hs-identifier hs-var">createPaymentWithChange</span></a><span> </span><a href="#local-6989586621679485026"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-329"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679485030"><a href="#local-6989586621679485030"><span class="hs-identifier">other</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#pubKeyTxOut"><span class="hs-identifier hs-var">pubKeyTxOut</span></a><span> </span><a href="#local-6989586621679485026"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679485027"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-330"></a><span>    </span><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier hs-var">signAndSubmit</span></a><span> </span><a href="#local-6989586621679485028"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679485030"><span class="hs-identifier hs-var">other</span></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier hs-var">maybeToList</span><span> </span><a href="#local-6989586621679485029"><span class="hs-identifier hs-var">own</span></a><span class="hs-special">)</span><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Transfer some funds to an address locked by a public key</span><span>
</span><a name="line-333"></a><span class="hs-identifier">payToPublicKey_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484956"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484956"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484956"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><a name="payToPublicKey_"><a href="Wallet.API.html#payToPublicKey_"><span class="hs-identifier">payToPublicKey_</span></a></a><span> </span><a name="local-6989586621679485031"><a href="#local-6989586621679485031"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Wallet.API.html#payToPublicKey"><span class="hs-identifier hs-var">payToPublicKey</span></a><span> </span><a href="#local-6989586621679485031"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-335"></a><span>
</span><a name="line-336"></a><span class="hs-comment">-- | Create a `TxOut'` that pays to a public key owned by us</span><span>
</span><a name="line-337"></a><span class="hs-identifier">ownPubKeyTxOut</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484955"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484955"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484955"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#TxOut%27"><span class="hs-identifier hs-type">TxOut'</span></a><span>
</span><a name="line-338"></a><a name="ownPubKeyTxOut"><a href="Wallet.API.html#ownPubKeyTxOut"><span class="hs-identifier">ownPubKeyTxOut</span></a></a><span> </span><a name="local-6989586621679485032"><a href="#local-6989586621679485032"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#pubKeyTxOut"><span class="hs-identifier hs-var">pubKeyTxOut</span></a><span> </span><a href="#local-6989586621679485032"><span class="hs-identifier hs-var">v</span></a><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><a href="Wallet.API.html#pubKey"><span class="hs-identifier hs-var">pubKey</span></a><span> </span><a href="Wallet.API.html#myKeyPair"><span class="hs-identifier hs-var">myKeyPair</span></a><span>
</span><a name="line-339"></a><span>
</span><a name="line-340"></a><span class="hs-comment">-- | Create a transaction, sign it and submit it</span><span>
</span><a name="line-341"></a><span class="hs-comment">--   TODO: Also compute the fee</span><span>
</span><a name="line-342"></a><span class="hs-identifier">signAndSubmit</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Monad</span><span> </span><a href="#local-6989586621679484954"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">,</span><span> </span><a href="Wallet.API.html#WalletAPI"><span class="hs-identifier hs-type">WalletAPI</span></a><span> </span><a href="#local-6989586621679484954"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Set.Set</span><span> </span><a href="Ledger.Types.html#TxIn%27"><span class="hs-identifier hs-type">TxIn'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#TxOut%27"><span class="hs-identifier hs-type">TxOut'</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679484954"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-type">Tx</span></a><span>
</span><a name="line-343"></a><a name="signAndSubmit"><a href="Wallet.API.html#signAndSubmit"><span class="hs-identifier">signAndSubmit</span></a></a><span> </span><a name="local-6989586621679485033"><a href="#local-6989586621679485033"><span class="hs-identifier">ins</span></a></a><span> </span><a name="local-6989586621679485034"><a href="#local-6989586621679485034"><span class="hs-identifier">outs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-344"></a><span>    </span><a name="local-6989586621679485035"><a href="#local-6989586621679485035"><span class="hs-identifier">sig</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">signature</span><span> </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="Wallet.API.html#myKeyPair"><span class="hs-identifier hs-var">myKeyPair</span></a><span>
</span><a name="line-345"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679485036"><a href="#local-6989586621679485036"><span class="hs-identifier">tx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Types.html#Tx"><span class="hs-identifier hs-var">Tx</span></a><span>
</span><a name="line-346"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">txInputs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679485033"><span class="hs-identifier hs-var">ins</span></a><span>
</span><a name="line-347"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">txOutputs</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679485034"><span class="hs-identifier hs-var">outs</span></a><span>
</span><a name="line-348"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">txForge</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-349"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">txFee</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-350"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">txSignatures</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679485035"><span class="hs-identifier hs-var">sig</span></a><span class="hs-special">]</span><span>
</span><a name="line-351"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-352"></a><span>    </span><a href="Wallet.API.html#submitTxn"><span class="hs-identifier hs-var">submitTxn</span></a><span> </span><a href="#local-6989586621679485036"><span class="hs-identifier hs-var">tx</span></a><span>
</span><a name="line-353"></a><span>    </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679485036"><span class="hs-identifier hs-var">tx</span></a><span>
</span><a name="line-354"></a></pre></body></html>