<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE DeriveAnyClass       #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DeriveGeneric        #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DerivingStrategies   #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FlexibleContexts     #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances    #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables  #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell      #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TypeApplications     #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><a name="line-10"></a><span class="hs-pragma">{-# OPTIONS_GHC -Wno-simplifiable-class-constraints #-}</span><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Ledger.Validation</span><span>
</span><a name="line-12"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-13"></a><span>    </span><span class="hs-comment">-- * Pending transactions and related types</span><span>
</span><a name="line-14"></a><span>      </span><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier hs-type">PendingTx</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#PendingTx%27"><span class="hs-identifier hs-type">PendingTx'</span></a><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#PendingTxOutRef"><span class="hs-identifier hs-type">PendingTxOutRef</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier hs-type">PendingTxIn</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#PendingTxOutType"><span class="hs-identifier hs-type">PendingTxOutType</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-20"></a><span>    </span><span class="hs-comment">-- ** Hashes (see note [Hashes in validator scripts])</span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-type">RedeemerHash</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-type">TxHash</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcDataScriptHash"><span class="hs-identifier hs-var">plcDataScriptHash</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcValidatorDigest"><span class="hs-identifier hs-var">plcValidatorDigest</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcRedeemerHash"><span class="hs-identifier hs-var">plcRedeemerHash</span></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcTxHash"><span class="hs-identifier hs-var">plcTxHash</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-comment">-- * Oracles</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#OracleValue"><span class="hs-identifier hs-type">OracleValue</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>    </span><span class="hs-comment">-- * Validator functions</span><span>
</span><a name="line-32"></a><span>    </span><span class="hs-comment">-- ** Signatures</span><span>
</span><a name="line-33"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#txSignedBy"><span class="hs-identifier hs-var">txSignedBy</span></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#txInSignedBy"><span class="hs-identifier hs-var">txInSignedBy</span></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-comment">-- ** Transactions</span><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#pubKeyOutput"><span class="hs-identifier hs-var">pubKeyOutput</span></a><span>
</span><a name="line-37"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#scriptOutput"><span class="hs-identifier hs-var">scriptOutput</span></a><span>
</span><a name="line-38"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#eqPubKey"><span class="hs-identifier hs-var">eqPubKey</span></a><span>
</span><a name="line-39"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#eqDataScript"><span class="hs-identifier hs-var">eqDataScript</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#eqRedeemer"><span class="hs-identifier hs-var">eqRedeemer</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#eqValidator"><span class="hs-identifier hs-var">eqValidator</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#eqTx"><span class="hs-identifier hs-var">eqTx</span></a><span>
</span><a name="line-43"></a><span>    </span><span class="hs-comment">-- * Hashes</span><span>
</span><a name="line-44"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcSHA2_256"><span class="hs-identifier hs-var">plcSHA2_256</span></a><span>
</span><a name="line-45"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#plcSHA3_256"><span class="hs-identifier hs-var">plcSHA3_256</span></a><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-47"></a><span>
</span><a name="line-48"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Codec.Serialise</span><span>              </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialise</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">deserialiseOrFail</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">serialise</span><span class="hs-special">)</span><span>
</span><a name="line-49"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Crypto.Hash</span><span>                  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Digest</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hash</span><span class="hs-special">)</span><span>
</span><a name="line-50"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Aeson</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-type">FromJSON</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toJSON</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">withText</span><span class="hs-special">)</span><span>
</span><a name="line-51"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Aeson</span><span>                   </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">JSON</span><span>
</span><a name="line-52"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Bifunctor</span><span>               </span><span class="hs-special">(</span><span class="hs-identifier hs-var">first</span><span class="hs-special">)</span><span>
</span><a name="line-53"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteArray</span><span>               </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BA</span><span>
</span><a name="line-54"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Base64</span><span>       </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Base64</span><span>
</span><a name="line-55"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span>         </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">BSL</span><span>
</span><a name="line-56"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Proxy</span><span>                   </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-57"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Swagger.Internal.Schema</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ToSchema</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">declareNamedSchema</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">paramSchemaToSchema</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">plain</span><span class="hs-special">)</span><span>
</span><a name="line-58"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Text.Encoding</span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">TE</span><span>
</span><a name="line-59"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">GHC.Generics</span><span>                 </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-60"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.Haskell.TH</span><span>          </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Q</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TExp</span><span class="hs-special">)</span><span>
</span><a name="line-61"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Language.PlutusTx.Lift</span><span>       </span><span class="hs-special">(</span><span class="hs-identifier hs-var">makeLift</span><span class="hs-special">)</span><span>
</span><a name="line-62"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Language.PlutusTx.Builtins</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Builtins</span><span>
</span><a name="line-63"></a><span class="hs-keyword">import</span><span>           </span><a href="Ledger.Types.html"><span class="hs-identifier">Ledger.Types</span></a><span>                 </span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-64"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Ledger.Types.html"><span class="hs-identifier">Ledger.Types</span></a><span>                 </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Ledger</span><span>
</span><a name="line-65"></a><span>
</span><a name="line-66"></a><span class="hs-comment">-- Ignore newtype warnings related to `Oracle` and `Signed` because it causes</span><span>
</span><a name="line-67"></a><span class="hs-comment">-- problems with the plugin</span><span>
</span><a name="line-68"></a><span class="hs-comment">--</span><span>
</span><a name="line-69"></a><span class="hs-comment">-- TODO: Remove annotation once `newtype Oracle = (...)` works</span><span>
</span><a name="line-70"></a><span class="hs-pragma">{-# ANN</span><span> </span><span class="hs-pragma">module</span><span> </span><span class="hs-pragma">&quot;HLint: ignore Use newtype instead of data&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">{- Note [Script types in pending transactions]
To validate a transaction, we have to evaluate the validation script of each of
the transaction's inputs. The validation script sees the data of the
transaction output it validates, and the redeemer of the transaction input of
the transaction that consumes it.
In addition, the validation script also needs information on the transaction as
a whole (not just the output-input pair it is concerned with). This information
is provided by the `PendingTx` type. A `PendingTx` contains the hashes of 
redeemer and data scripts of all of its inputs and outputs.
-}</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">data</span><span> </span><a name="PendingTxOutType"><a href="Ledger.Validation.html#PendingTxOutType"><span class="hs-identifier">PendingTxOutType</span></a></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a name="PubKeyTxOut"><a href="Ledger.Validation.html#PubKeyTxOut"><span class="hs-identifier">PubKeyTxOut</span></a></a><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-comment">-- ^ Pub key address</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="DataTxOut"><a href="Ledger.Validation.html#DataTxOut"><span class="hs-identifier">DataTxOut</span></a></a><span> </span><span class="hs-comment">-- ^ The data script of the pending transaction output (see note [Script types in pending transactions])</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Output of a pending transaction.</span><span>
</span><a name="line-89"></a><span class="hs-keyword">data</span><span> </span><a name="PendingTxOut"><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier">PendingTxOut</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PendingTxOut"><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier">PendingTxOut</span></a></a><span>
</span><a name="line-90"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="pendingTxOutValue"><a href="Ledger.Validation.html#pendingTxOutValue"><span class="hs-identifier">pendingTxOutValue</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOutHashes"><a href="Ledger.Validation.html#pendingTxOutHashes"><span class="hs-identifier">pendingTxOutHashes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Hashes of validator script and data script</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOutData"><a href="Ledger.Validation.html#pendingTxOutData"><span class="hs-identifier">pendingTxOutData</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTxOutType"><span class="hs-identifier hs-type">PendingTxOutType</span></a><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>
</span><a name="line-95"></a><span class="hs-keyword">data</span><span> </span><a name="PendingTxOutRef"><a href="Ledger.Validation.html#PendingTxOutRef"><span class="hs-identifier">PendingTxOutRef</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PendingTxOutRef"><a href="Ledger.Validation.html#PendingTxOutRef"><span class="hs-identifier">PendingTxOutRef</span></a></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="pendingTxOutRefId"><a href="Ledger.Validation.html#pendingTxOutRefId"><span class="hs-identifier">pendingTxOutRefId</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-type">TxHash</span></a><span> </span><span class="hs-comment">-- ^ Transaction whose outputs are consumed</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOutRefIdx"><a href="Ledger.Validation.html#pendingTxOutRefIdx"><span class="hs-identifier">pendingTxOutRefIdx</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ Index into the referenced transaction's list of outputs</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOutSigs"><a href="Ledger.Validation.html#pendingTxOutSigs"><span class="hs-identifier">pendingTxOutSigs</span></a></a><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span class="hs-special">]</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- | Input of a pending transaction.</span><span>
</span><a name="line-102"></a><span class="hs-keyword">data</span><span> </span><a name="PendingTxIn"><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier">PendingTxIn</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PendingTxIn"><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier">PendingTxIn</span></a></a><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="pendingTxInRef"><a href="Ledger.Validation.html#pendingTxInRef"><span class="hs-identifier">pendingTxInRef</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTxOutRef"><span class="hs-identifier hs-type">PendingTxOutRef</span></a><span>
</span><a name="line-104"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxInRefHashes"><a href="Ledger.Validation.html#pendingTxInRefHashes"><span class="hs-identifier">pendingTxInRefHashes</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-type">RedeemerHash</span></a><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Hashes of validator and redeemer scripts</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxInValue"><a href="Ledger.Validation.html#pendingTxInValue"><span class="hs-identifier">pendingTxInValue</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span> </span><span class="hs-comment">-- ^ Value consumed by this txn input</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">-- | A pending transaction as seen by validator scripts.</span><span>
</span><a name="line-109"></a><span class="hs-keyword">data</span><span> </span><a name="PendingTx"><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier">PendingTx</span></a></a><span> </span><a name="local-6989586621679340152"><a href="#local-6989586621679340152"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PendingTx"><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier">PendingTx</span></a></a><span>
</span><a name="line-110"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="pendingTxInputs"><a href="Ledger.Validation.html#pendingTxInputs"><span class="hs-identifier">pendingTxInputs</span></a></a><span>      </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier hs-type">PendingTxIn</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ Transaction inputs</span><span>
</span><a name="line-111"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOutputs"><a href="Ledger.Validation.html#pendingTxOutputs"><span class="hs-identifier">pendingTxOutputs</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span class="hs-special">]</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxFee"><a href="Ledger.Validation.html#pendingTxFee"><span class="hs-identifier">pendingTxFee</span></a></a><span>         </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-113"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxForge"><a href="Ledger.Validation.html#pendingTxForge"><span class="hs-identifier">pendingTxForge</span></a></a><span>       </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Value"><span class="hs-identifier hs-type">Value</span></a><span>
</span><a name="line-114"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxBlockHeight"><a href="Ledger.Validation.html#pendingTxBlockHeight"><span class="hs-identifier">pendingTxBlockHeight</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span>
</span><a name="line-115"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxSignatures"><a href="Ledger.Validation.html#pendingTxSignatures"><span class="hs-identifier">pendingTxSignatures</span></a></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span class="hs-special">]</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pendingTxOwnHash"><a href="Ledger.Validation.html#pendingTxOwnHash"><span class="hs-identifier">pendingTxOwnHash</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679340152"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-comment">-- ^ Hash of the validator script that is currently running</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-keyword">type</span><span> </span><a name="PendingTx%27"><a href="Ledger.Validation.html#PendingTx%27"><span class="hs-identifier">PendingTx'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier hs-type">PendingTx</span></a><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">{- Note [Oracles]
I'm not sure how oracles are going to work eventually, so I'm going to use this
definition for now:
* Oracles are identified by their public key
* An oracle can produce &quot;observations&quot;, which are values annotated with time
  (block height). These observations are signed by the oracle. This means we are
  assume a _trusted_ oracle (as opposed to services such as
  http://www.oraclize.it/ who provide untrusted oracles). Trusting the oracle
  makes sense when dealing with financial data: Current prices etc. are usually
  provided by companies such as Bloomberg or Yahoo Finance, who are
  necessarily trusted by the consumers of their data. It seems reasonable to
  assume that similar providers will exist for Plutus, who simply sign the
  data with a known key in the way we implemented it here.
* To use an oracle value inside a validator script, it has to be provided as the
  redeemer script of the transaction that consumes the output locked by the
  validator script.
Examples of this can be found in the
Language.Plutus.Coordination.Contracts.Swap.swapValidator and
Language.Plutus.Coordination.Contracts.Future.validatorScript scripts.
-}</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span class="hs-comment">-- `OracleValue a` is the value observed at a time signed by</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- an oracle. See note [Oracles]</span><span>
</span><a name="line-144"></a><span class="hs-keyword">data</span><span> </span><a name="OracleValue"><a href="Ledger.Validation.html#OracleValue"><span class="hs-identifier">OracleValue</span></a></a><span> </span><a name="local-6989586621679340151"><a href="#local-6989586621679340151"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="OracleValue"><a href="Ledger.Validation.html#OracleValue"><span class="hs-identifier">OracleValue</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-145"></a><span>        </span><a name="ovSignature"><a href="Ledger.Validation.html#ovSignature"><span class="hs-identifier">ovSignature</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span class="hs-special">,</span><span>
</span><a name="line-146"></a><span>        </span><a name="ovHeight"><a href="Ledger.Validation.html#ovHeight"><span class="hs-identifier">ovHeight</span></a></a><span>    </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Height"><span class="hs-identifier hs-type">Height</span></a><span class="hs-special">,</span><span>
</span><a name="line-147"></a><span>        </span><a name="ovValue"><a href="Ledger.Validation.html#ovValue"><span class="hs-identifier">ovValue</span></a></a><span>     </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679340151"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-148"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-149"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-150"></a><span>
</span><a name="line-151"></a><span class="hs-comment">{- Note [Hashes in validator scripts]

We need to deal with hashes of four different things in a validator script:

1. Transactions
2. Validator scripts
3. Data scripts
4. Redeemer scripts

The mockchain code in [[Ledger.Types]] only deals with the hashes of(1)
and (2), and uses the [[Ledger.TxId']] and `Digest SHA256` types for
them.

In PLC validator scripts the situation is different: First, they need to work
with hashes of (1-4). Second, the `Digest SHA256` type is not available in PLC
- we have to represent all hashes as `ByteStrings`.

To ensure that we only compare hashes of the correct type inside a validator
script, we define a newtype for each of them, as well as functions for creating
them from the correct types in Haskell, and for comparing them (in
`Language.Plutus.Runtime.TH`).

-}</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- | PLC runtime representation of a `Digest SHA256`</span><span>
</span><a name="line-175"></a><span class="hs-keyword">newtype</span><span> </span><a name="ValidatorHash"><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier">ValidatorHash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-176"></a><span>    </span><a name="ValidatorHash"><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier">ValidatorHash</span></a></a><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">stock</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-keyword">newtype</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Serialise</span><span class="hs-special">)</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToSchema</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-181"></a><span>    </span><a name="local-8214565720323828888"><span class="hs-identifier">declareNamedSchema</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">plain</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">paramSchemaToSchema</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Proxy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Proxy</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">ToJSON</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-184"></a><span>    </span><a name="local-8214565720323823140"><span class="hs-identifier">toJSON</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">JSON.String</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TE.decodeUtf8</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">Base64.encode</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">BSL.toStrict</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">serialise</span><span>
</span><a name="line-185"></a><span>
</span><a name="line-186"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">FromJSON</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-187"></a><span>    </span><a name="local-8214565720323823082"><span class="hs-identifier">parseJSON</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withText</span><span> </span><span class="hs-string">&quot;ValidatorScript&quot;</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679340153"><a href="#local-6989586621679340153"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-188"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679340154"><a href="#local-6989586621679340154"><span class="hs-identifier">ev</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-189"></a><span>                </span><a name="local-6989586621679340155"><a href="#local-6989586621679340155"><span class="hs-identifier">eun64</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">Base64.decode</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">TE.encodeUtf8</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679340153"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-190"></a><span>                </span><span class="hs-identifier hs-var">first</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">deserialiseOrFail</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">BSL.fromStrict</span><span> </span><a href="#local-6989586621679340155"><span class="hs-identifier hs-var">eun64</span></a><span>
</span><a name="line-191"></a><span>        </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679340154"><span class="hs-identifier hs-var">ev</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-192"></a><span>            </span><span class="hs-identifier hs-var">Left</span><span> </span><a name="local-6989586621679340156"><a href="#local-6989586621679340156"><span class="hs-identifier">e</span></a></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">fail</span><span> </span><a href="#local-6989586621679340156"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-193"></a><span>            </span><span class="hs-identifier hs-var">Right</span><span> </span><a name="local-6989586621679340157"><a href="#local-6989586621679340157"><span class="hs-identifier">v</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><a href="#local-6989586621679340157"><span class="hs-identifier hs-var">v</span></a><span>
</span><a name="line-194"></a><span>
</span><a name="line-195"></a><span class="hs-keyword">newtype</span><span> </span><a name="DataScriptHash"><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier">DataScriptHash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-196"></a><span>    </span><a name="DataScriptHash"><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier">DataScriptHash</span></a></a><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-197"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span>
</span><a name="line-199"></a><span class="hs-keyword">newtype</span><span> </span><a name="RedeemerHash"><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier">RedeemerHash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-200"></a><span>    </span><a name="RedeemerHash"><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier">RedeemerHash</span></a></a><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-keyword">newtype</span><span> </span><a name="TxHash"><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier">TxHash</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-204"></a><span>    </span><a name="TxHash"><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier">TxHash</span></a></a><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Generic</span><span class="hs-special">)</span><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span class="hs-identifier">plcDataScriptHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#DataScript"><span class="hs-identifier hs-type">Ledger.DataScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span>
</span><a name="line-208"></a><a name="plcDataScriptHash"><a href="Ledger.Validation.html#plcDataScriptHash"><span class="hs-identifier">plcDataScriptHash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-var">DataScriptHash</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ledger.Validation.html#plcHash"><span class="hs-identifier hs-var">plcHash</span></a><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-identifier">plcValidatorDigest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Digest</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span>
</span><a name="line-211"></a><a name="plcValidatorDigest"><a href="Ledger.Validation.html#plcValidatorDigest"><span class="hs-identifier">plcValidatorDigest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-var">ValidatorHash</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier hs-var">plcDigest</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><span class="hs-identifier">plcRedeemerHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#RedeemerScript"><span class="hs-identifier hs-type">Ledger.RedeemerScript</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-type">RedeemerHash</span></a><span>
</span><a name="line-214"></a><a name="plcRedeemerHash"><a href="Ledger.Validation.html#plcRedeemerHash"><span class="hs-identifier">plcRedeemerHash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-var">RedeemerHash</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ledger.Validation.html#plcHash"><span class="hs-identifier hs-var">plcHash</span></a><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span class="hs-identifier">plcTxHash</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#TxId%27"><span class="hs-identifier hs-type">Ledger.TxId'</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-type">TxHash</span></a><span>
</span><a name="line-217"></a><a name="plcTxHash"><a href="Ledger.Validation.html#plcTxHash"><span class="hs-identifier">plcTxHash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-var">TxHash</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier hs-var">plcDigest</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">Ledger.getTxId</span><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span class="hs-comment">-- | PLC-compatible hash of a hashable value</span><span>
</span><a name="line-220"></a><span class="hs-identifier">plcHash</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BA.ByteArrayAccess</span><span> </span><a href="#local-6989586621679340160"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679340160"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-221"></a><a name="plcHash"><a href="Ledger.Validation.html#plcHash"><span class="hs-identifier">plcHash</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier hs-var">plcDigest</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span>
</span><a name="line-222"></a><span>
</span><a name="line-223"></a><span class="hs-comment">-- | PLC-compatible double SHA256 hash of a hashable value</span><span>
</span><a name="line-224"></a><span class="hs-identifier">plcSHA2_256</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BA.ByteArrayAccess</span><span> </span><a href="#local-6989586621679340159"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679340159"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-225"></a><a name="plcSHA2_256"><a href="Ledger.Validation.html#plcSHA2_256"><span class="hs-identifier">plcSHA2_256</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier hs-var">plcDigest</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Digest</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span>
</span><a name="line-226"></a><span>
</span><a name="line-227"></a><span class="hs-comment">-- | PLC-compatible triple SHA256 hash of a hashable value</span><span>
</span><a name="line-228"></a><span class="hs-identifier">plcSHA3_256</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">BA.ByteArrayAccess</span><span> </span><a href="#local-6989586621679340158"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679340158"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-229"></a><a name="plcSHA3_256"><a href="Ledger.Validation.html#plcSHA3_256"><span class="hs-identifier">plcSHA3_256</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier hs-var">plcDigest</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Digest</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span> </span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Digest</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">hash</span><span>
</span><a name="line-230"></a><span>
</span><a name="line-231"></a><span class="hs-comment">-- | Convert a `Digest SHA256` to a PLC `Hash`</span><span>
</span><a name="line-232"></a><span class="hs-identifier">plcDigest</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Digest</span><span> </span><span class="hs-identifier hs-type">SHA256</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">BSL.ByteString</span><span>
</span><a name="line-233"></a><a name="plcDigest"><a href="Ledger.Validation.html#plcDigest"><span class="hs-identifier">plcDigest</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">serialise</span><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-comment">-- | Check if a transaction was signed by a public key</span><span>
</span><a name="line-236"></a><span class="hs-identifier">txSignedBy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier hs-type">PendingTx</span></a><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-237"></a><a name="txSignedBy"><a href="Ledger.Validation.html#txSignedBy"><span class="hs-identifier">txSignedBy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span>
</span><a name="line-238"></a><span>    </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679340161"><a href="#local-6989586621679340161"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier hs-type">PendingTx</span></a><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-var">PubKey</span></a><span> </span><a name="local-6989586621679340162"><a href="#local-6989586621679340162"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-239"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-240"></a><span>            </span><a href="Ledger.Validation.html#PendingTx"><span class="hs-identifier hs-var">PendingTx</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679340163"><a href="#local-6989586621679340163"><span class="hs-identifier">sigs</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679340161"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-241"></a><span>
</span><a name="line-242"></a><span>            </span><span class="hs-identifier">signedBy'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-243"></a><span>            </span><a name="local-6989586621679340164"><a href="#local-6989586621679340164"><span class="hs-identifier">signedBy'</span></a></a><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-var">Signature</span></a><span> </span><a name="local-6989586621679340166"><a href="#local-6989586621679340166"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679340166"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679340162"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-244"></a><span>
</span><a name="line-245"></a><span>            </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-246"></a><span>            </span><a name="local-6989586621679340165"><a href="#local-6989586621679340165"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679340167"><a href="#local-6989586621679340167"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679340167"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-247"></a><span>                        </span><a name="local-6989586621679340168"><a href="#local-6989586621679340168"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679340169"><a href="#local-6989586621679340169"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679340164"><span class="hs-identifier hs-var">signedBy'</span></a><span> </span><a href="#local-6989586621679340168"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679340165"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679340169"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-248"></a><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-249"></a><span>        </span><span class="hs-keyword">in</span><span>
</span><a name="line-250"></a><span>            </span><a href="#local-6989586621679340165"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679340163"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-251"></a><span>    </span><span class="hs-special">||]</span><span>
</span><a name="line-252"></a><span>
</span><a name="line-253"></a><span class="hs-comment">-- | Check if the input of a pending transaction was signed by a public key</span><span>
</span><a name="line-254"></a><span class="hs-identifier">txInSignedBy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier hs-type">PendingTxIn</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-255"></a><a name="txInSignedBy"><a href="Ledger.Validation.html#txInSignedBy"><span class="hs-identifier">txInSignedBy</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span>
</span><a name="line-256"></a><span>    </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679340170"><a href="#local-6989586621679340170"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier hs-type">PendingTxIn</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-var">PubKey</span></a><span> </span><a name="local-6989586621679340171"><a href="#local-6989586621679340171"><span class="hs-identifier">k</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-257"></a><span>        </span><span class="hs-keyword">let</span><span>
</span><a name="line-258"></a><span>            </span><a href="Ledger.Validation.html#PendingTxIn"><span class="hs-identifier hs-var">PendingTxIn</span></a><span> </span><a name="local-6989586621679340172"><a href="#local-6989586621679340172"><span class="hs-identifier">ref</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span>      </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679340170"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-259"></a><span>            </span><a href="Ledger.Validation.html#PendingTxOutRef"><span class="hs-identifier hs-var">PendingTxOutRef</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679340173"><a href="#local-6989586621679340173"><span class="hs-identifier">sigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679340172"><span class="hs-identifier hs-var">ref</span></a><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span>            </span><span class="hs-identifier">signedBy'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-262"></a><span>            </span><a name="local-6989586621679340174"><a href="#local-6989586621679340174"><span class="hs-identifier">signedBy'</span></a></a><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-var">Signature</span></a><span> </span><a name="local-6989586621679340176"><a href="#local-6989586621679340176"><span class="hs-identifier">i'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679340176"><span class="hs-identifier hs-var">i'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679340171"><span class="hs-identifier hs-var">k</span></a><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>            </span><span class="hs-identifier">go</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Ledger.Types.html#Signature"><span class="hs-identifier hs-type">Signature</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-265"></a><span>            </span><a name="local-6989586621679340175"><a href="#local-6989586621679340175"><span class="hs-identifier">go</span></a></a><span> </span><a name="local-6989586621679340177"><a href="#local-6989586621679340177"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679340177"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-266"></a><span>                        </span><a name="local-6989586621679340178"><a href="#local-6989586621679340178"><span class="hs-identifier">s</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679340179"><a href="#local-6989586621679340179"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679340174"><span class="hs-identifier hs-var">signedBy'</span></a><span> </span><a href="#local-6989586621679340178"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">True</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679340175"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679340179"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-267"></a><span>                        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-268"></a><span>        </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679340175"><span class="hs-identifier hs-var">go</span></a><span> </span><a href="#local-6989586621679340173"><span class="hs-identifier hs-var">sigs</span></a><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span>    </span><span class="hs-special">||]</span><span>
</span><a name="line-271"></a><span>
</span><a name="line-272"></a><span class="hs-comment">-- | Returns the public key that locks the transaction output</span><span>
</span><a name="line-273"></a><span class="hs-identifier">pubKeyOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-274"></a><a name="pubKeyOutput"><a href="Ledger.Validation.html#pubKeyOutput"><span class="hs-identifier">pubKeyOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679340180"><a href="#local-6989586621679340180"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679340180"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-275"></a><span>    </span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-var">PendingTxOut</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#PubKeyTxOut"><span class="hs-identifier hs-var">PubKeyTxOut</span></a><span> </span><a name="local-6989586621679340181"><a href="#local-6989586621679340181"><span class="hs-identifier">pk</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679340181"><span class="hs-identifier hs-var">pk</span></a><span>
</span><a name="line-276"></a><span>    </span><span class="hs-identifier">_</span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-277"></a><span>
</span><a name="line-278"></a><span class="hs-comment">-- | Returns the data script that is part of the pay-to-script transaction</span><span>
</span><a name="line-279"></a><span class="hs-comment">--   output</span><span>
</span><a name="line-280"></a><span class="hs-identifier">scriptOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span class="hs-special">,</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-281"></a><a name="scriptOutput"><a href="Ledger.Validation.html#scriptOutput"><span class="hs-identifier">scriptOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679340182"><a href="#local-6989586621679340182"><span class="hs-identifier">o</span></a></a><span class="hs-glyph">::</span><span> </span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-type">PendingTxOut</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679340182"><span class="hs-identifier hs-var">o</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-282"></a><span>    </span><a href="Ledger.Validation.html#PendingTxOut"><span class="hs-identifier hs-var">PendingTxOut</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679340183"><a href="#local-6989586621679340183"><span class="hs-identifier">d</span></a></a><span> </span><a href="Ledger.Validation.html#DataTxOut"><span class="hs-identifier hs-var">DataTxOut</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679340183"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-283"></a><span>    </span><span class="hs-identifier">_</span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-284"></a><span>
</span><a name="line-285"></a><span class="hs-comment">-- | Equality of public keys</span><span>
</span><a name="line-286"></a><span class="hs-identifier">eqPubKey</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-type">PubKey</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-287"></a><a name="eqPubKey"><a href="Ledger.Validation.html#eqPubKey"><span class="hs-identifier">eqPubKey</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-var">PubKey</span></a><span> </span><a name="local-6989586621679340184"><a href="#local-6989586621679340184"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Types.html#PubKey"><span class="hs-identifier hs-var">PubKey</span></a><span> </span><a name="local-6989586621679340185"><a href="#local-6989586621679340185"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679340184"><span class="hs-identifier hs-var">l</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679340185"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-comment">-- | Equality of data scripts</span><span>
</span><a name="line-290"></a><span class="hs-identifier">eqDataScript</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-type">DataScriptHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-291"></a><a name="eqDataScript"><a href="Ledger.Validation.html#eqDataScript"><span class="hs-identifier">eqDataScript</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-var">DataScriptHash</span></a><span> </span><a name="local-6989586621679340186"><a href="#local-6989586621679340186"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#DataScriptHash"><span class="hs-identifier hs-var">DataScriptHash</span></a><span> </span><a name="local-6989586621679340187"><a href="#local-6989586621679340187"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Builtins.equalsByteString</span><span> </span><a href="#local-6989586621679340186"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679340187"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-292"></a><span>
</span><a name="line-293"></a><span class="hs-comment">-- | Equality of validator scripts</span><span>
</span><a name="line-294"></a><span class="hs-identifier">eqValidator</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-type">ValidatorHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-295"></a><a name="eqValidator"><a href="Ledger.Validation.html#eqValidator"><span class="hs-identifier">eqValidator</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-var">ValidatorHash</span></a><span> </span><a name="local-6989586621679340188"><a href="#local-6989586621679340188"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#ValidatorHash"><span class="hs-identifier hs-var">ValidatorHash</span></a><span> </span><a name="local-6989586621679340189"><a href="#local-6989586621679340189"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Builtins.equalsByteString</span><span> </span><a href="#local-6989586621679340188"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679340189"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-296"></a><span>
</span><a name="line-297"></a><span class="hs-comment">-- | Equality of redeemer scripts</span><span>
</span><a name="line-298"></a><span class="hs-identifier">eqRedeemer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-type">RedeemerHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-type">RedeemerHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-299"></a><a name="eqRedeemer"><a href="Ledger.Validation.html#eqRedeemer"><span class="hs-identifier">eqRedeemer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-var">RedeemerHash</span></a><span> </span><a name="local-6989586621679340190"><a href="#local-6989586621679340190"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#RedeemerHash"><span class="hs-identifier hs-var">RedeemerHash</span></a><span> </span><a name="local-6989586621679340191"><a href="#local-6989586621679340191"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Builtins.equalsByteString</span><span> </span><a href="#local-6989586621679340190"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679340191"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-comment">-- | Equality of transactions</span><span>
</span><a name="line-302"></a><span class="hs-identifier">eqTx</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Q</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">TExp</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-type">TxHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-type">TxHash</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><a name="eqTx"><a href="Ledger.Validation.html#eqTx"><span class="hs-identifier">eqTx</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[||</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-var">TxHash</span></a><span> </span><a name="local-6989586621679340192"><a href="#local-6989586621679340192"><span class="hs-identifier">l</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Ledger.Validation.html#TxHash"><span class="hs-identifier hs-var">TxHash</span></a><span> </span><a name="local-6989586621679340193"><a href="#local-6989586621679340193"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Builtins.equalsByteString</span><span> </span><a href="#local-6989586621679340192"><span class="hs-identifier hs-var">l</span></a><span> </span><a href="#local-6989586621679340193"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-special">||]</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span>
</span><a name="line-307"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">PendingTxOutType</span><span>
</span><a name="line-308"></a><span>
</span><a name="line-309"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">PendingTxOut</span><span>
</span><a name="line-310"></a><span>
</span><a name="line-311"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">PendingTxOutRef</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">PendingTxIn</span><span>
</span><a name="line-314"></a><span>
</span><a name="line-315"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">PendingTx</span><span>
</span><a name="line-316"></a><span>
</span><a name="line-317"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">OracleValue</span><span>
</span><a name="line-318"></a><span>
</span><a name="line-319"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">ValidatorHash</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">DataScriptHash</span><span>
</span><a name="line-322"></a><span>
</span><a name="line-323"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">RedeemerHash</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-identifier hs-var">makeLift</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">TxHash</span><span>
</span><a name="line-326"></a></pre></body></html>